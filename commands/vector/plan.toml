# Copyright 2026 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

description = "ðŸ—ºï¸ PLAN: Strategy Phase. Develop a rigorous implementation roadmap."
prompt = """
You are entering the **STRATEGY (Plan)** phase.

**User Objective:** "{{args}}"

**Goal:** Create a specific, atomic, and verified implementation plan.

**Interaction Standards:**
1.  **Explicit Understanding:**
    *   Start by explaining your understanding of the user's request.
    *   State *how* you intend to proceed (the approach).
    *   Acknowledge the command and wait for implicit confirmation (by presenting the plan checklist).
2.  **Checklist:** The final plan MUST be a checklist for user approval.

**Protocol:**
1.  **Context Review:**
    *   Read `.gemini/CONTEXT.md` (Project Constraints) and `.gemini/STATE.md` (Investigation Findings).
    *   **CRITICAL:** NEVER use `run_shell_command` to execute `/vector:*` commands. These are for the USER to type.
2.  **Strategic Analysis:**
    *   **First Principles:** Deconstruct the User Objective into its fundamental requirements.
    *   **Trade-off Analysis:** Briefly evaluate 2-3 approaches (e.g., Simplest vs. Most Performant vs. Most Robust). Select the best fit for the Project Standards.
    *   **Risk Assessment (Pre-Mortem):** Identify potential failure modes (breaking changes, side effects, dependency conflicts) and define mitigation steps.
3.  **Plan Generation:**
    *   **Draft** a step-by-step plan. Each step must be:
        *   **Atomic:** One logical change.
        *   **Verifiable:** Include a specific test or check to confirm success.
    *   **WRITE** this plan to `.gemini/PLAN.md`.
    *   **Format:**
        *   **Objective:** [Clear Goal]
        *   **Selected Strategy:** [Rationale]
        *   **Implementation Plan:** [Numbered List of Atomic Steps]
        *   **Backlog:** [Optional: Parked ideas/future tasks. PRESERVE existing.]
4.  **State Update:**
    *   Update `**Phase:**` in `.gemini/STATE.md` to `[STRATEGY]`.
    *   **Constraint:** **DO NOT** overwrite the `## ðŸ“ Scratchpad` or Findings. Only update the Phase line.

**Output:**
*   **Analysis Summary:** Why this approach was chosen.
*   **Plan Checklist:** Present the plan as a checklist (`- [ ] Step...`) and ask for approval.
*   **Prompt:** "Plan established. Ready to Execute?"
*   **Navigation:** Append: `> Recommended Action: /vector:work <first_step>`
*   **Stopping Criteria:** DO NOT execute the plan. DO NOT write code. **STOP** and **WAIT** for user approval. **DO NOT** execute the recommended command.
"""